\documentclass[letterpaper,final,12pt,reqno]{amsart}

\usepackage[total={6.3in,9.2in},top=1.1in,left=1.1in]{geometry}

\usepackage{times,bm,bbm,empheq,fancyvrb,graphicx,amsthm,amssymb}
\usepackage[dvipsnames]{xcolor}
\usepackage{longtable}
\usepackage{booktabs}

\usepackage[within=section]{newfloat}

\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}

\usepackage[kw]{pseudo}
\pseudoset{left-margin=15mm,topsep=5mm,idfont=\texttt}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % ...
citecolor=Red,    % ...
urlcolor=black    % ...
]{hyperref}

\renewcommand{\baselinestretch}{1.05}

\allowdisplaybreaks[1]  % allow display breaks in align environments, if they avoid major underfulls

\newtheoremstyle{cstyle}% name
  {5pt}% space above
  {5pt}% space below
  {\itshape}% body font
  {}% indent amount
  {\itshape}% theorem head font
  {.}% punctuation after theorem head
  {.5em}% space after theorem head
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}% theorem head spec
\theoremstyle{cstyle}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{assumptions}[theorem]{Assumptions}

\newtheoremstyle{cstyle*}% name
  {5pt}% space above
  {5pt}% space below
  {\itshape}% body font
  {}% indent amount
  {\itshape}% theorem head font
  {.}% punctuation after theorem head
  {.5em}% space after theorem head
  {\thmname{#1}}% theorem head spec
\theoremstyle{cstyle*}
\newtheorem{assumptions*}{Assumptions}

\newtheoremstyle{dstyle}% name
  {5pt}% space above
  {5pt}% space below
  {}%{\itshape}% body font
  {}% indent amount
  {\itshape}% theorem head font
  {.}% punctuation after theorem head
  {.5em}% space after theorem head
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}% theorem head spec
\theoremstyle{dstyle}

\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

% numbering
\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{table}{section}
\numberwithin{theorem}{section}

\newcommand{\eps}{\epsilon}
\newcommand{\RR}{\mathbb{R}}

\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\trace}{\operatorname{tr}}

\newcommand{\hbn}{\hat{\mathbf{n}}}

\newcommand{\bb}{\mathbf{b}}
\newcommand{\be}{\mathbf{e}}
\newcommand{\bbf}{\mathbf{f}}
\newcommand{\bg}{\mathbf{g}}
\newcommand{\bn}{\mathbf{n}}
\newcommand{\br}{\mathbf{r}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bv}{\mathbf{v}}
\newcommand{\bw}{\mathbf{w}}
\newcommand{\bx}{\mathbf{x}}
\newcommand{\bF}{\mathbf{F}}
\newcommand{\bV}{\mathbf{V}}
\newcommand{\bX}{\mathbf{X}}
\newcommand{\bxi}{\bm{\xi}}
\newcommand{\bzero}{\bm{0}}

\newcommand{\cK}{\mathcal{K}}
\newcommand{\cV}{\mathcal{V}}

\newcommand{\rhoi}{\rho_{\text{i}}}

\newcommand{\ip}[2]{\left<#1,#2\right>}

\newcommand{\mR}{R^{\bm{\oplus}}}
\newcommand{\iR}{R^{\bullet}}

\newcommand{\nn}{{\text{n}}}
\newcommand{\pp}{{\text{p}}}
\newcommand{\qq}{{\text{q}}}
\newcommand{\rr}{{\text{r}}}

\newcommand{\supp}{\operatorname{supp}}
\newcommand{\Span}{\operatorname{span}}

\DeclareFloatingEnvironment[name=Pseudocode]{pcode}


\begin{document}
\title[On multilevel constraint decomposition methods]{On multilevel constraint decomposition methods \\ for nonlinear variational inequalities}

\author{Ed Bueler}

\date{\today}

\begin{abstract} FIXME
\end{abstract}

\maketitle

%\tableofcontents

\thispagestyle{empty}
%\bigskip

\section{Introduction} \label{sec:intro}

The goal of this paper is to generalize the constraint decomposition (CD) method of X.-C.~Tai \cite{Tai2003}.  We extend this solution method to nonlinear variational inequality (VI) problems for which it has not been previously considered, we address important finite element (FE) implementation details, and we demonstrate the resulting performance.

The convergence of the CD method for several types of decompositions was proven in \cite{Tai2003} in the case of coercive VIs which arise from minimization of a convex functional over a convex set.  In its multilevel form the CD method has been shown to have optimal complexity for elliptic, linear obstacle problems \cite[subsection 5.4]{Tai2003}; see also Theorem 4.6 and Algorithm 4.7 in \cite{GraeserKornhuber2009}.

We extend the original algorithms, theory, and examples presented in \cite{Tai2003} in four particular directions:
\renewcommand{\labelenumi}{\emph{(\roman{enumi})}}
\begin{enumerate}
\item In contrast to \cite{Tai2003}, we do not assume that the continuum VI problem arises from optimization of a scalar objective.  Nonetheless we can prove convergence at the same rate (Section \ref{sec:convergence}); % HOPE
examples are explored in Sections \ref{sec:vi} and \ref{sec:results}.
\item We observe that the iterates from the CD method are always admissible, and thus the residual functional need only be defined on the admissible subset; Section \ref{sec:results} includes an example.  Admissible-iterate methods allow direct solutions of certain VI problems, such as fluid-layer dynamics problems \cite{Bueler2021conservation,JouvetBueler2012} for which non-admissible methods, such as semi-smooth methods \cite{BensonMunson2006}, may require unnatural modifications of the residual form.
\item In the multilevel case we make the observation that, if implemented appropriately, V(0,$\nu$) ``up-slash'' cycles are intrinsically more efficient than the V($\nu$,0) ``down-slash'' cycles (Section \ref{sec:multilevel}).  This observation seems to be new for multilevel CD methods; compare the comments on V(1,0) and V(1,1) cycles in \cite{GraeserKornhuber2009,Tai2003}.  Strong preference for up-smoothing is, apparently, special to multilevel CD methods and does not arise in corresponding unconstrained problems.
\item In the multilevel and nonlinear case, we make the CD algorithm practical by addressing efficient storage of intermediate quantities.  In particular, in Section \ref{sec:results} we show results from a full approximation storage (FAS; see \cite{Brandt1977}) implementation.  Thereby we avoid global (Newton) linearization when solving nonlinear VI problems; compare \cite{GraeserKornhuber2009}.
\end{enumerate}

Especially for the classical obstacle problem, i.e.~for a Laplacian functional, certain other methods are known to improve performance relative to the multilevel CD method \cite{GraeserKornhuber2009}.  These improved multilevel methods either track the active set or modify the nodal basis functions, and in this sense they are discrete algorithms.  By contrast the CD method applies at the level of the continuum problem (see below); it is more fundamental than the truncated monotone multigrid method \cite{Kornhuber1994}, for example, in that sense, and we can demonstrate comparable rates of convergence (Section \ref{sec:results}). % HOPE
Furthermore, truncated monotone approaches for nonlinear problems have, so far, applied a global linearization strategy \cite{GraeserKornhuber2009}, while we apply FAS (Section \ref{sec:multilevel}).  In any case, acceleration of our nonlinear multilevel CD method by such active-set and/or basis-level manipulations is a topic for further research.

% A BRIDGE TOO FAR:  In one example at the end of this paper (Section \ref{sec:resultsnonlocal}) we consider a nonlocal residual functional, that is, one which is not a partial differential operator.  Each evaluation of this functional requires the solution of a Stokes problem for a layer of fluid \nocite{SayagWorster2013} on a substrate (which forms the obstacle), and thus the corresponding FE operator discretization is also not sparse.  In this case we cannot prove coercivity but we nonetheless succeed in demonstrating near-optimal complexity of the Section \ref{sec:multilevel} multilevel CD algorithm in practice.


\section{Coercive variational inequalities} \label{sec:vi}

Suppose $\cV$ is a real, reflexive Banach space with norm $\|\cdot\|$ and topological dual space $\cV'$.  Denote the dual pairing of $\phi \in \cV'$ and $v\in\cV$ by $\ip{\phi}{v} = \phi(v)$, and note that $\|\phi\|_{\cV'} = \sup_{\|v\|=1} |\ip{\phi}{v}|$ defines a Banach space norm on $\cV'$.

Let $\cK \subset \cV$ be a nonempty closed and convex subset, the \emph{constraint set}; elements of $\cK$ are said to be \emph{admissible}.  For a continuous \emph{residual functional} $f:\cK \to \cV'$ and \emph{source} $g\in \cV'$ we consider the following \emph{variational inequality} (VI) for the (exact) solution $u^*\in \cK$:
\begin{equation}
\ip{f(u^*)}{v-u^*} \ge \ip{g}{v-u^*} \qquad \text{for all } v\in \cK. \label{eq:vi}
\end{equation}
Because $f$ is a (generally) nonlinear map, $g$ is not strictly needed, but its presence is helpful to the algorithms of Section \ref{sec:multilevel}.  (By redefining $f$ we may take $g=0$.)

VI \eqref{eq:vi} generalizes the nonlinear system of equations $f(u^*)=g$ from a vector space $\cV$ to the constrained case (over $\cK$).  Informally, if we conceptualize the dual pairing as an inner product, then \eqref{eq:vi} says that the angle between $f(u^*)-g$ and any arbitrary vector $v-u$ pointing from $u$ into $\cK$ is at most $90^\circ$.  That is, \eqref{eq:vi} says that $f(u^*)-g$ points directly into $\cK$ if $u^* \in\partial\cK$, while if $u^* \in \cK^\circ$ (interior) then \eqref{eq:vi} implies $f(u^*)=g$.

The following definitions are standard \cite{KinderlehrerStampacchia1980}.

\begin{definition} A map $f:\cK \to \cV'$ is \emph{monotone} if
\begin{equation}
\ip{f(u)-f(v)}{u-v} \ge 0 \qquad \text{for all } u,v \in \cK, \label{eq:monotone}
\end{equation}
\emph{strictly monotone} if equality in \eqref{eq:monotone} implies $u=v$, and \emph{coercive} if there exists $w \in \cK$ so that
\begin{equation}
\frac{\ip{f(u)-f(w)}{u-w}}{\|u-w\|} \to +\infty \qquad \text{as } \|u\|\to +\infty. \label{eq:coercive}
\end{equation}
\end{definition}

It is well-known that if $f:\cK \to \cV'$ is continuous, monotone, and coercive then VI \eqref{eq:vi} has a solution \cite[Corollary III.1.8]{KinderlehrerStampacchia1980}, and also that the solution $u^* \in \cK$ is unique if $f$ is strictly monotone.  The condition of continuity can be weakened to only apply on finite-dimensional subspaces \cite{KinderlehrerStampacchia1980}, but the stronger condition will apply in our examples.  As in the calculus of variations \cite{Evans2010}, coercivity permits a compactness argument even for unbounded sets $\cK$; recall that the bounded, closed subsets of a reflexive Banach space are weakly compact.

The VIs solved in this paper satisfy a stronger form of coercivity than \eqref{eq:coercive}.

\begin{definition}  Let $p>1$.  The map $f:\cK \to \cV'$ is \emph{$p$-coercive} if there exists $\kappa>0$ such that
\begin{equation}
\ip{f(u)-f(v)}{u-v} \ge \kappa \|u-v\|^p \qquad \text{for all } u,v \in \cK. \label{eq:pcoercive}
\end{equation}
(Note \cite{Tai2003} uses ``coercive'' for $2$-coercive.)
\end{definition}

It is easy to see that if $f$ is $p$-coercive then it is monotone, strictly monotone, and coercive, and thus the following result, which states that the $p$-coercive VI problems considered in this paper are well-posed, holds.

\begin{theorem}  \label{thm:viwellposed}  If $f:\cK \to \cV'$ is continuous and $p$-coercive (for $p>1$) then there exists a unique $u\in \cK$ solving VI \eqref{eq:vi}.
\end{theorem}

When $f$ is monotone, VI \eqref{eq:vi} generalizes the problem of minimizing a convex function over $\cK$.  In fact, suppose $F:\cK \to \RR$ is lower semi-continuous and (G\^ateau) differentiable with continuous derivative $F':\cK \to \cV'$.  Then $F$ is convex if and only if $F'$ is monotone \cite[Proposition I.5.5]{EkelandTemam1976}.  Furthermore, Proposition II.2.1 in the same reference shows that if $F$ is convex then \eqref{eq:vi} holds for $f=F'$ (and $g=0$) if and only if
\begin{equation}
u^* = \operatorname{arg-min}_{v\in\cK} F(v). \label{eq:minimization}
\end{equation}

From now on $\Omega \subset \RR^d$ denotes a bounded, open set with smooth or piecewise-smooth (e.g.~polygonal) boundary.  Note that Sobolev spaces \cite{Evans2010} are denoted here by $W^{k,p}(\Omega)$, with Hilbert-space cases denoted $W^{k,2}=H^k$.

Many numerical solvers for VIs, including the CD methods of Tai \cite{Tai2003}, address optimization problem \eqref{eq:minimization} under the hypothesis that $F'$ is coercive.  The following example includes the classical obstacle problem \cite{GraeserKornhuber2009} and the obstacle problem for the $p$-Laplacian \cite{ChoeLewis1991}.

\begin{example}  \label{ex:plaplacian}  Suppose $a\in L^\infty(\Omega)$ such that $a(x)\ge a_0$ a.e.~for some constant $a_0>0$, and $p\ge 2$.  For $u,v \in \cV = W^{1,p}_0(\Omega)$ define $f:\cV \to \cV'$ by
\begin{equation}
\ip{f(u)}{v} = \int_\Omega a(x) |\grad u|^{p-2} \grad u \cdot \grad v\,dx. \label{eq:plaplacian}
\end{equation}
Now, if $x,y\in\RR^d$ then $(|x|^{p-2} x - |y|^{p-2} y)\cdot (x-y) \ge 2^{2-p} |x-y|^p$ \cite[see Appendix A and references therein]{Bueler2021conservation}.  It follows from the Poincar\'e inequality that
    $$\ip{f(u) - f(v)}{u-v} \ge 2^{2-p} a_0 \|\grad u - \grad v\|_p^p \ge 2^{2-p} a_0 C \|u-v\|^p$$
for some $C>0$, and thus $f$ is $p$-coercive.  (The same $f$ is coercive if $1<p<2$ but the proof is somewhat different \cite[Theorem 4.4]{Bueler2021conservation}.)  Also, for $g\in\cV'$ define
    $$F(u) = \int_\Omega \frac{a(x)}{p} |\grad u|^p\,dx - g(u).$$
Then $F'(u) = f(u) - g$, $F$ is a convex functional (since $f$ is coercive), and, for any closed and convex $\cK\subset \cV$, VI problem \eqref{eq:vi} for $f$ and $g$ is equivalent to optimization problem \eqref{eq:minimization} for $F$.
\end{example}

However, not all VIs correspond to optimization.  We give two such examples next, first a linear advection-diffusion problem and then a nonlinear porous-medium-type problem.  Each of these examples, which are important in applications, is preceded by a lemma.

\begin{lemma}  \label{lem:advectionskew}  \cite{Elmanetal2014}\,  Suppose $\bX :\Omega \to \RR^d$ is a smooth and bounded vector field on $\Omega$ with zero divergence ($\Div \bX=0$).  For $u,v \in H^1(\Omega)$ let $s(u,v) = \int_\Omega (\bX \cdot \grad u) v\,dx$.  Then $s(v,v) = \frac{1}{2} \int_{\partial \Omega} v^2 \bX\cdot \bn\,dx$ where $\bn$ is the outward normal on $\partial \Omega$.
\end{lemma}

\begin{proof}
Integration by parts gives $s(u,v) = - s(v,u) + \int_{\partial \Omega} uv \bX\cdot \bn\,dx$, so the result follows.
\end{proof}

\begin{example}  \label{ex:advectiondiffusion}  Suppose $\partial\Omega$ is partitioned into Dirichlet and Neumann portions, i.e.~$\partial\Omega = \partial_D\Omega \cup \partial_N\Omega$, with $\partial_D\Omega$ of positive measure.  Let $\cV = H_0^1(\Omega)$ be the space of functions with value zero on $\partial_D\Omega$.  (For simplicity we consider zero boundary data.)  Choose a smooth and bounded velocity field $\bX$ on $\Omega$ such that $\Div \bX=0$, but additionally assume outward flow on the Neumann boundary, i.e.~$\bX \cdot \bn \ge 0$ at points of $\partial_N\Omega$.  For $u,v \in \cV = H_0^1(\Omega)$ and $\eps>0$ define
\begin{equation}
\ip{f(u)}{v} = \int_\Omega \eps \grad u \cdot \grad v - (\bX \cdot \grad u) v\,dx. \label{eq:advectiondiffusion}
\end{equation}
Consider VI \eqref{eq:vi} for any closed and convex $\cK \subset \cV$ and any $g\in\cV'$.  It is easy to see that $|\ip{f(u)}{v}| \le (\eps + \|\bX\|_\infty) \|u\| \|v\|$, thus that $f:\cK \to \cV'$ is continuous.  On the other hand, by Lemma \ref{lem:advectionskew}, which says that $s(u,v)$ is skew-symmetric up to a nonnegative addition, and by the outward flow assumption and the Poincar\'e inequality,
\begin{align*}
\ip{f(u)-f(v)}{u-v} &= \eps \int_\Omega |\grad u - \grad v|^2\,dx + s(u-v,u-v) \\
                    &= \eps \int_\Omega |\grad u - \grad v|^2\,dx + \frac{1}{2} \int_{\partial_N\Omega} (u-v)^2 \bX\cdot\bn \ge \eps C \|u-v\|^2.
\end{align*}
Thus $f$ is 2-coercive, and so VI problem \eqref{eq:vi} is well-posed for any closed and convex $\cK \subset \cV$ and $g\in \cV'$.
\end{example}

However, if $\bX \ne 0$ then \eqref{eq:vi} for the functional \eqref{eq:advectiondiffusion} is not a (constrained) minimization problem.  Indeed, the Jacobian of $f$ is the bilinear form $J_f(u,v) = \int_\Omega \eps \grad u \cdot \grad v\,dx - s(u,v)$.  For nonzero advection this is not symmetric, thus it cannot be the Hessian of an objective $F$.  (For $u,v$ which are zero on all of $\partial \Omega$, $J_f(u,v) - J_f(v,u) = -2 s(u,v)$, and we may then construct $u,v$ so this result is nonzero anywhere $\bX$ is nonzero.)

References \cite{Bueler2021conservation,ChangNakshatrala2017} consider such advection-diffusion VI problems over $\cK = \{v\ge 0\}$.

\begin{example}  \label{ex:porousgeneralization}  FIXME. I THINK THIS IS NOT GOING TO WORK.  COERCIVITY IS SUPER FRAGILE W.R.T. THIS CHANGE?
\begin{equation}
\ip{f(u)}{v} = \int_\Omega \phi(u) \grad u \cdot \grad v\,dx \label{eq:porousgeneralization}
\end{equation}
\end{example}

Examples \ref{ex:advectiondiffusion} and \ref{ex:porousgeneralization} are VI problems which do not arise from optimization.  Further examples are in ice sheet models \cite{Calvoetal2002,JouvetBueler2012} and other geophysical fluids \cite{Bueler2021conservation}.  Numerical solver performance for Examples \ref{ex:advectiondiffusion}--\ref{ex:plaplacian} will be considered in section \ref{sec:results}.  % HOPE


\section{Constraint decomposition, the basic algorithm} \label{sec:cd}

The multilevel algorithms in Section \ref{sec:multilevel} are based on the more general notion of a solution by constraint decomposition, as follows.  Suppose there are $m<\infty$ subspaces $\cV_i \subset \cV$ so that
\begin{equation}
\cV = \sum_{i=0}^{m-1} \cV_i \label{eq:subspacedecomp}
\end{equation}
holds in the sense that if $w \in \cV$ then there exist $w_i \in \cV_i$ so that $w = \sum_i w_i$; this is called a \emph{subspace decomposition} \cite{Xu1992}.  Suppose further that $\cK_i \subset \cV$ are nonempty, closed, and convex subsets such that
\begin{equation}
\cK_i \subset \cV_i \qquad \text{and} \qquad \cK = \sum_{i=0}^{m-1} \cK_i. \label{eq:constraintdecomp}
\end{equation}
The sum in \eqref{eq:constraintdecomp} is required to hold in two senses: \emph{(i)}~if $w \in \cK$ then there exist $w_i \in \cK_i$ so that $w = \sum_i w_i$, and \emph{(ii)}~if $z_i \in \cK_i$ for each $i$ then $\sum_i z_i \in \cK$.  (The latter sense is automatic in \eqref{eq:subspacedecomp} because $\cV_i$ are subspaces.)  Note that neither decomposition \eqref{eq:subspacedecomp} or \eqref{eq:constraintdecomp} is unique (in general), and that $\cK_i \not\subset \cK$ in many applications.

Following \cite{Tai2003}, for each $\cK_i$ we also assume a bounded, (generally) nonlinear restriction operator $R_i : \cK \to \cK_i$ such that
\begin{equation}
v = \sum_{i=0}^{m-1} R_i v \qquad \text{if } v \in \cK.  \label{eq:constraintrestrictionsum}
\end{equation}
A \emph{constraint decomposition} (CD) of $\cK$ is a choice of $\cV_i,\cK_i,R_i$ satisfying \eqref{eq:subspacedecomp}--\eqref{eq:constraintrestrictionsum}.

In the Section \ref{sec:multilevel} we will introduce discretizations and describe practical algorithms, but the CDs in this section can apply at the level of the continuum problem.  The following two examples illustrate this for obstacle problems \cite{GraeserKornhuber2009}.   Example \ref{ex:domaindecomposition} is an overlapping domain decomposition and Example \ref{ex:frequencydecomposition} is a nonoverlapping frequency decomposition.  (The multilevel FE CD in Section \ref{sec:multilevel} approximately implements a frequency decomposition.)

\begin{example}  \label{ex:domaindecomposition}  Consider a bounded domain $\Omega \subset \RR^d$, let $\cV = W_0^{k,p}(\Omega)$ for $k\ge 0$ and $p\ge 1$, and suppose the obstacle $\psi \in W^{k,p}(\Omega)$ satisfies $\psi|_{\partial \Omega} \le 0$.  Let $\cK = \{v \ge \psi\} \subset \cV$.  Suppose further that $\{\phi_i\}_{i=0}^{m-1}$ is a smooth partition of unity on $\Omega$, i.e.~so that $0 \le \phi_i\le 1$ and $\sum_i \phi_i = 1$, and let $\Omega_i$ be the support of $\phi_i$.  Let $\cV_i = \{w \in \cV:w|_{\Omega \setminus \Omega_i} =0 \}$, $\cK_i = \{v \in \cV_i: v \ge \phi_i \psi\}$, and $R_i(v) = \phi_i v$.  Then \eqref{eq:subspacedecomp}, \eqref{eq:constraintdecomp}, and \eqref{eq:constraintrestrictionsum} all hold.
\end{example}

%Note that the boundedness of $R_i(v) = \max\{v,\phi_i \psi\}$ depends on the relatively-low regularity of $\cV = H_0^1(\Omega)$.  That is, if $u,v \in H^{1,p}(\Omega)$ for $1\le p \le \infty$ then $\max\{u,v\} \in H^{1,p}(\Omega)$.  (To prove this note $\max\{u,0\} \in H^{1,p}(\Omega)$ is shown by \cite[Theorem II.A.1]{KinderlehrerStampacchia1980}; then combine with facts $\max\{a,b\} = \frac{1}{2} (a + b + |a-b|)$ and $|a| = \max\{a,0\} + \max\{-a,0\}$ for $a\in\RR$.)  However, Sobolev spaces $H^{k,p}(\Omega)$ are not generally closed under the maximum operation for $k\ge 2$.

\begin{example}  \label{ex:frequencydecomposition}  For simplicity suppose $\Omega = (0,a)^d \subset \RR^d$ for $a>0$, a cube, and let $\cV = H_{\text{per}}^k(\Omega)$, $k\ge 0$, be the periodic functions.  Suppose $\psi \in H^k(\Omega)$ and let $\cK = \{v \ge \psi\} \subset \cV$.  Without giving any detailed notation of frequency representation, but noting that the frequencies are discrete, suppose $\cV_i \subset \cV$ are $m<\infty$ subspaces from an (nonoverlapping) partition by frequency, thus satisfying \eqref{eq:subspacedecomp}.  Suppose $P_i:\cV \to \cV_i$ are the corresponding orthogonal projections, satisfying $I = \sum_i P_i$.  Let $\cK_i = \{v \ge P_i \psi\} \subset \cV_i$ and $R_i = P_i$.  Then \eqref{eq:constraintdecomp} and \eqref{eq:constraintrestrictionsum} hold.
\end{example}

In Example \ref{ex:domaindecomposition}, note that $\cK_i \not\subset \cK$ in many cases, for example if $\psi$ is positive over portions of $\Omega$ where the decomposition into overlapping subdomains $\Omega_i$ is nontrivial.  A similar comment applies in Example \ref{ex:frequencydecomposition}.

We now state the basic CD algorithm as an iteration which solves VI problems over each set $\cK_i$.  (By contrast, algorithms in \cite{Tai2003} solve \emph{optimization} problems.)  There are parallel (additive) and successive (multiplicative) versions; these generalize the Jacobi and Gauss-Seidel iterations \cite{Greenbaum1997}, respectively.  Each starts from a current iterate $u \in \cK$ and computes a new iterate $w\in\cK$, an improved approximation of the solution $u^* \in \cK$ of VI problem \eqref{eq:vi}, according to a damping parameter $0<\alpha\le 1$.  If \pr{parallel} $=$ \text{\textbf{true}} then the \text{\textbf{for}} loop can be computed in any order.

\begin{pseudo*}
\pr{cd}(0<\alpha\le 1, u\in\cK)\text{:} \\+
    if \pr{parallel}: \\+
        for $i \in \{0,\dots,m-1\}$: \\+
            $\hat w_i\in \cK_i$: \\+
                 $\boxed{\ip{f(u - R_i u + \hat w_i)}{v_i-\hat w_i} \ge g(v_i-\hat w_i)} \quad \forall v_i\in \cK_i$ \\---
    else: \\+
        for $i = 0,\dots,m-1$: \\+
            $\hat w_i\in \cK_i$: \\+
                $\displaystyle \boxed{\ip{f\Big(\sum_{j<i} w_j + \hat w_i + \sum_{j>i} R_j u\Big)}{v_i-\hat w_i} \ge g(v_i-\hat w_i)} \quad \forall v_i\in \cK_i$ \\-
            $w_i = (1-\alpha) R_i u + \alpha \hat w_i$ \\--
    $\hat w = \sum_i \hat w_i$ \\
    return $w=(1-\alpha) u + \alpha \hat w$
\end{pseudo*}

The reader may confirm that, inside each boxed VI, the argument of $f$ is an element of $\cK$.  On the other hand, the expression $v_i - \hat w_i$ appears.  To clarify this situation, note that by \eqref{eq:constraintdecomp} and \eqref{eq:constraintrestrictionsum} one may write $v_i - \hat w_i$ as a difference of admissible vectors (i.e.~from $\cK$), namely
\begin{align*}
[u - R_i u + v_i] - [u - R_i u + \hat w_i] &= v_i - \hat w_i, \label{eq:admissibledifference} \\
\left[\sum_{j<i} w_j + v_i + \sum_{j>i} R_j u\right] - \left[\sum_{j<i} w_j + \hat w_i + \sum_{j>i} R_j u\right] &= v_i - \hat w_i,  \notag
\end{align*}
for the two versions, respectively.  In other words, we solve VI \eqref{eq:vi} over (parallel or successive) perturbations from the sets $\cK_i$.  In fact, if
\begin{equation}
e_i = \hat w_i - R_i u \in \cV_i \label{eq:ithupdate}
\end{equation}
is the update in $\cK_i$ then we may then write $w = u + \alpha \sum_i e_i$.  In particular, note that $u - R_i u + \hat w_i = u + e_i$; the \pr{parallel} version computes the updates $e_i$ independently.

The convergence results in the next section require substantial damping in the parallel algorithm, i.e.~$\alpha \le 1/m$, as in \cite{Tai2003} as well, but the successive version can be shown to converge without damping ($\alpha=1$).  In Section \ref{sec:results} we demonstrate practical convergence for a larger range of $\alpha$ than suggested by the theory.  % HOPE

In Section \ref{sec:multilevel} we will convert the basic algorithm into a multilevel approach for an obstacle problem by choosing appropriate $\cK_i$ based on a FE triangulation.  However, in order that the algorithm has a practical and efficient implementation, we will require additional concepts when $f$ has any of the following properties: \emph{(i)} $f$ is defined only on $\cK$, or \emph{(ii)} $f$ is nonlinear, or \emph{(iii)} $f$ is non-local.  The issue of practical implementation for such $f$ seems not to have been addressed by references which apply CD algorithms only to the classical obstacle problem \cite[in particular]{GraeserKornhuber2009,Tai2003}.  Consider the following example.

\begin{example}  \label{ex:fnice} Suppose $f:\cV \to \cV'$ is linear and defined on all of $\cV$.  Furthermore suppose $f$ is local in the sense that a basis $\{\phi_i\}$ of $\cV_i$ exists with each support small in $\Omega$, and that $\ip{f(\phi_i)}{z}$ can be computed by an integral over the support of $\phi_i$.  (When $\cV$ is an FE space then this is the usual case for evaluating PDE weak forms over a basis of hat functions; see Section \ref{sec:multilevel}.)  Considering only the parallel algorithm, for simplicity, the VI over $\cK_i$ can be written as
\begin{equation}
\ip{f(\hat w_i - R_i u)}{v_i-\hat w_i} \ge \tilde g(v_i-\hat w_i) \label{eq:linearlocalvi}
\end{equation}
for all $v_i\in \cK_i$, where $\tilde g(z) = g(z) - \ip{f(u)}{z}$.  Noting $e_i = \hat w_i - R_i u \in \cV_i \notin \cK$, in general, VI \eqref{eq:linearlocalvi} only makes sense because $f$ is defined over $\cV_i$.  Thus each subset problem \eqref{eq:linearlocalvi} can be solved using a stored residual $\ip{f(y)}{\cdot}$ (in the updated source term) and incrementally by computations over the basis supports.  In other words, because $f$ has all these nice properties, the solution of each VI problem can be computed by inexpensive means.
\end{example}

A solver which would work for Example \ref{ex:fnice} has implementation efficiencies that are unavailable in general.  Additional ideas, like those in Section \ref{sec:multilevel}, are needed for practical application of CD methods to problems which are not close to the classical obstacle problem.  In particular, we will extend the basic algorithm to nonlinear $f:\cK\to \cV'$ by applying the full approximation storage (FAS) idea of Brandt \cite{Brandt1977}.  However, extending the algorithm to non-local residual functionals is a topic for future research.


\section{Convergence of the basic algorithm} \label{sec:convergence}

To prove the convergence of the basic algorithm we make two assumptions as follows.

\begin{assumptions*}  \emph{Lipschitz restrictions}: There exists a constant $C_1>0$ so that
\begin{equation}
\left(\sum_{i=0}^{m-1} \|R_i u - R_i v\|^2\right)^{1/2} \le C_1 \|u-v\| \label{as:lipschitzrestrictions}
\end{equation}
for all $u,v\in\cK$.  \emph{Totally Lipschitz residual}: There exists $C_2>0$ so that
\begin{equation}
\sum_{i=0}^{m-1} \sum_{j=0}^{m-1} \left|\ip{f(w_{ij} + v_i) - f(w_{ij})}{y_i}\right| \le C_2 \left(\sum_{i=0}^{m-1} \|v_i\|^2\right)^{1/2} \left(\sum_{i=0}^{m-1} \|y_i\|^2\right)^{1/2} \label{as:totallylipschitzresidual}
\end{equation}
for all $w_{ij} \in \cK$ and $v_i,y_i \in \cV_i$ such that $w_{ij} + v_i \in \cK$ (for all $i,j$).  Note that the constants $C_1,C_2$ generally depend on $m$.
\end{assumptions*}
% IF PROOF BELOW SUCCEEDS, SO ALGORITHM IS NORM DECREASING, THEN MAY BE ABLE TO ARGUE THAT IT IS O.K. FOR CONSTANTS TO DEPEND ON $u,v,w_{ij}$ etc. AS LONG AS THEY ARE UNIFORMLY BOUNDED ON CERTAIN BOUNDED SETS

Though the assumptions are technical in certain senses, the reader should note some essential features:
\begin{itemize}
\item Assumption \eqref{as:lipschitzrestrictions} addresses only the constraint decomposition.  Furthermore, it is often the case that \eqref{as:totallylipschitzresidual} addresses only a subspace decomposition property of the residual functional.  (For example, in the classical obstacle problem \eqref{as:totallylipschitzresidual} is verified over the (sub)spaces $\cV$ and $\cV_i$, and the subsets $\cK$ and $\cK_i$ are not involved.)
\item The assumptions are identical to inequalities (7), (8) in \cite{Tai2003} where they are used to prove convergence of the optimization version(s) of the basic CD algorithm.  See also their unconstrained versions, inequalities (13), (14) in \cite{TaiXu2002}.
\item Tai \cite{Tai2003} gives values of the constants $C_1$ in \eqref{as:lipschitzrestrictions} for obstacle problem constraint decompositions using $P_1$ FE spaces over a shape-regular and quasi-uniform triangulation.  In particular, constants $C_1$ are know for overlapping domain decompositions (with or without an additional coarse mesh) and standard multilevel heirarchies.
% ASSUMING $f$ IS LIPSCHITZ WILL MAKE THE EXISTENCE OF C_2 CLEAR; SEE (14) IN \cite{TaiXu2002}
\end{itemize}

FIXME

\section{Finite elements and multilevel constraint decomposition} \label{sec:multilevel}

Until now the algorithms can be interpreted as infinite-dimensional, e.g.~supposing constraint sets as defined in Examples \ref{ex:domaindecomposition} or \ref{ex:frequencydecomposition}.  However, in practice we will solve VI \eqref{eq:vi} over a mesh and the space $\cV$ will be a finite element (FE) space.  Thus $\cV$, and each subspace $\cV_i$, will be finite-dimensional.

FIXME triangulation

\begin{example}  FIXME if $\cV_i=\Span\{\phi_i\}$ for $\phi_i\in\cV$ are 1d spaces and if $\cK = \{v \ge \psi\} \subset \cV$ (obstacle problem), and if $R_i : \cK \to \cK_i$ for obstacle problem; note $\cK_i \not\subset \cK$ when $\psi>0$
\end{example}

FIXME state essentially Algorithm 4.7 \cite{GraeserKornhuber2009} but with $\text{V}(\nu_1,\nu_2)$ cycles which works for linear; observe that up-smoothing is more efficient; state the FAS version which has $O(m)$ residual evaluation complexity on each level


\section{Results for local variational inequalities} \label{sec:results}

FIXME


% A BRIDGE TOO FAR:  \section{Results for a nonlocal variational inequality} \label{sec:resultsnonlocal}



\small
\bibliography{mcd2}
\bibliographystyle{siam}

\end{document}
